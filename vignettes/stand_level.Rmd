---
title: "Stand level"
#author: "Vignette Author"
#date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Stand-level}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

Once all trees were detected function was applied on the normalized point cloud and the tree list was generated, stand-level metrics and variables can be estimated. These estimations can be based on different plot designs i.e., circular fixed area, k-tree and angle-count plots. The sizes of the plots can be regulated by defining the radius, k and the basal area factor (BAF) respectively.

## Computing stand-level metrics and variables

In order to calculare metrics and variables at stand-level, the function **`metrics.variables`** is applied as follows:

```{r eval=FALSE, include=TRUE}
metrcis <- metrics.variables(tree.tls = tree.list.single.tls, 
                  tree.ds = NULL, tree.field = NULL,
                  plot.design = c("fixed.area", "k.tree", "angle.count"),
                  plot.parameters = data.frame(radius = 25, k = 50, BAF = 4),
                  scan.approach = "single", var.metr = NULL,
                  dbh.min = 4, h.min = 1.3, max.dist = Inf, 
                  dir.data = NULL, save.result = TRUE, dir.result = NULL)
```

The input data frame is introduced in **`tree.tls`** and should contain information about the trees detected from TLS based data e.g., the output data frame of the functions `tree.detection.single.scan` or `tree.detection.multi.scan`. Optionally, the path of the directory of the .txt files containing the reduced point cloud data generated by the function `normalize` can be specified in **`dir.data`** otherwise the current working directory will be assigned to this argument. If **`save.result`** is set to `save.result = TRUE` (default setting), the output files (see ....) will be saved to the directory indicated in **`dir.result`**.

The scan approach, either TLS single-scan (`"single"`) or TLS multi-scan and SLAM point clouds approaches (`"multi"`) have to be specified in the argument **`scan.approach`**. By default, the argument is set to `"multi"`.

If only a selection of metrics and variables should be calculated, the metrics and variables of interest can be specified in a vector by **`var.metr`**. If nothing is specified, the argument is set to `NULL` and all posible metrics and variables will be calculated. 

#### Additional information about the trees obtained by distance sampling and field data

When the distance sampling method (`distance.sampling` function) was applied, the list with tree detection probabilities (i.e., the output file of the mentioned function) can be introduced in **`tree.ds`**. By default, this argument is set to `NULL` and metrics using distance sampling corrections will not be calculated.

If supplementary field data is availeble for the sample plot, a data frame containing this information can be included in **`tree.field`**. Each row of the data frame must represent a tree and at least the following columns must be part of the data frame:

- `id`: plot identification number (character string or numeric), which must coincide with those in the `id` column of the `tree.tls` argument i.e., the list of trees yielded by the tree detection functions
- `tree`: number of the tree
- `h.dist`: horizontal distance (in m) of the tree's center to the plot's center, which must coincide with the centres of their corresponding TLS plots
- `dbh`: tree diameter (in cm) at breast height (1.3 m)
- `h`: total tree height (in m)
- `dead`: integer value indicating wether the tree is dead (1) or not (NA)

Further optional columns are `h.blc` (height based live crown, in m), `h.bdc` (height based dead crown, in m), `v.user` (tree volume, in m$^3$) and `w.user` (tree biomass, in Mg).

#### Selecting trees to be included in the calculations

The arguments **`dbh.min`**, **`h.min`** and **`max.dist`** are used to determine the trees that are included in the calculations. The minimum diameter at breast height (dbh) and the minimum tree height can be specified in `dbh.min` (in cm) and `h.min` (in m) and are set to 4 cm and 1.3 m respectively by default. In `max.dist`, the maximal horizontal distance (in m) of a tree from the plot's center to be included in the calculations can be defined. If not specified, no trees are discarded because of their distance.

#### Plot design and parameters

The metrics and values can be computed for different plot designs which are specified by **`plot.design`** and **`plot.parameters`**. There are three different plot designs, which are similar to the procedure used in conventional forest inventories. The plot design, which is to be used can be specified in `plot.design`. By default, all plot designs will be considered.

As the name implies, circular fixed area plots (`"fixed.area"`) are plots with a circular area defined by the plot radius (in m). The size of k-tree plots (`"k.tree"`) is determined by the number of trees (k) that enter the plot. The basal area factor (BAF in m$^2$/ha) defines the angle-count plots (`"angle.count"`). The parameters `radius`, `k` and `BAF` have to be specified as data frame in `plot.parameters`. If the one of these parameters is not specified, the corresponding plot design will not be considered in the calculations. To calculate the dominant height and diameter, the number of dominant trees per ha (trees/ha) can be indicated by the argument `num.tree`. By default, the number of dominant trees is set to 100 trees/ha.

### Stand-level metrics



### Stand-level variables
