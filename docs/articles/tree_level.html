<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="FORTLS">
<title>Tree-level • FORTLS</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tree-level">
<meta property="og:description" content="FORTLS">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">FORTLS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/stand_level.html">Stand level</a>
    <a class="dropdown-item" href="../articles/tree_level.html">Tree-level</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Molina-Valero/FORTLS/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Tree-level</h1>
                        <h4 data-toc-skip class="author">Anika
Seppelt</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Molina-Valero/FORTLS/blob/HEAD/vignettes/tree_level.Rmd" class="external-link"><code>vignettes/tree_level.Rmd</code></a></small>
      <div class="d-none name"><code>tree_level.Rmd</code></div>
    </div>

    
    
<p>FORTLS is used for processing of point cloud data derived from
terrestrial-based technologies such as Terrestrial Laser Scanning (TLS)
or Simultaneous Localization and Mapping (SLAM). Point cloud data must
be provided as .las or .laz files. The first obligatory step is the
normalization of the point cloud applying the function
<code>normalize</code>. The obtained normalized point clouds serve as
input data for the tree detection functions
i.e. <code>tree.detection.single.scan</code>,
<code>tree.detection.multi.scan</code> and
<code>tree.detection.several.plots</code>. The function
<code>tree.detection.single.scan</code> detects trees from normalized
TLS single-scan data and <code>tree.detection.multi.scan</code> from
normalized TLS multi-scan (or SLAM) data. If data from more than one
plot is to be analyzed automatically, the function
<code>tree.detection.several.plots</code> should be used, which includes
both the normalization and the tree detection functions and executes
these functions on each input plot sequentially.</p>
<div class="section level2">
<h2 id="normalization">Normalization<a class="anchor" aria-label="anchor" href="#normalization"></a>
</h2>
<p>The aim of the normalization process is obtaining the coordinates
relative to the plot’s center and the ground level. In this process, the
functions <code>readLAS</code>, <code>clip_circle</code>,
<code>classify_ground</code>, <code>grid_terrain</code> and
<code>normalize_height</code> from the <a href="https://cran.r-project.org/web/packages/lidR/index.html" class="external-link">lidR</a>
package are used internally (Roussel et al., 2020<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>). The following steps
are executed:</p>
<ul>
<li>Classification of points as “ground” or “not ground” by the cloth
simulation filter (CSF) algorithm (Zhang et al., 2016<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>)</li>
<li>Generation of a digital terrain model (DTM) by spatial interpolation
of the points classified as “ground”</li>
<li>Normalization of the point cloud by subtracting the DTM and
computation of the Cartesian, cylindrical and spherical coordinates</li>
<li>Reduction of the density of the point cloud. In case of single-scan
approach data, the densitiy is reduced by the point cropping (PCP)
algorithm (Molina-Valero et al., 2019<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>) and in the case of multi-scan approach
data, the point density reduction is based on random selection of
points</li>
</ul>
<p>The following figure shows the normalized point cloud which is used
as example data below. The function <code>plot</code> from the <a href="https://cran.r-project.org/web/packages/lidR/index.html" class="external-link">lidR</a>
package is used to generate the figure.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dir.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"exdata"</span>, package<span class="op">=</span><span class="st">"FORTLS"</span><span class="op">)</span>
<span class="va">multiLAS</span> <span class="op">&lt;-</span> <span class="fu">readLAS</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">dir.data</span>, <span class="st">"Galicia_multi_scan.laz"</span>, sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">lidR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lidR/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">multiLAS</span>, color <span class="op">=</span> <span class="st">"RGB"</span><span class="op">)</span></code></pre></div>
<p><img src="pointcloud1.jpg" alt="drawing" width="300"></p>
<div class="section level3">
<h3 id="the-arguments-of-normalize">The arguments of <code>normalize</code><a class="anchor" aria-label="anchor" href="#the-arguments-of-normalize"></a>
</h3>
<p>The <code>normalize</code> function is applied as follows:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pcd.single</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalize.html">normalize</a></span><span class="op">(</span>las <span class="op">=</span> <span class="st">"Galicia_single_scan.laz"</span>, 
                 normalized <span class="op">=</span> <span class="cn">TRUE</span>,
                 x.center <span class="op">=</span> <span class="fl">0</span>, y.center <span class="op">=</span> <span class="fl">0</span>,
                 max.dist <span class="op">=</span> <span class="fl">15</span>, min.height <span class="op">=</span> <span class="cn">NULL</span>, max.height <span class="op">=</span> <span class="cn">NULL</span>, 
                 algorithm.dtm <span class="op">=</span> <span class="st">"knnidw"</span>, res.dtm <span class="op">=</span> <span class="fl">0.2</span>,
                 csf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cloth_resolution <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,
                 RGB <span class="op">=</span> <span class="cn">TRUE</span>,
                 scan.approach <span class="op">=</span> <span class="st">"single"</span>,
                 id <span class="op">=</span> <span class="cn">NULL</span>, file <span class="op">=</span> <span class="st">"single"</span>,
                 dir.data <span class="op">=</span> <span class="va">dir.data</span>, save.result <span class="op">=</span> <span class="cn">FALSE</span>, dir.result <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></code></pre></div>
<p>The name of the .las or .laz file containing the point cloud data is
introduced in <strong><code>las</code></strong> argument and must
include the .las/.laz extension. Optionally, the plot identification
number (<strong><code>id</code></strong>) and the file name
(<strong><code>file</code></strong>) can be defined. Both are set to
<code>NULL</code> by default, which assigns <code>1</code> to the plot
identification number and <code>1.txt</code> (same name as the
identification number) to the reduced point cloud saved in the working
directory specified in <strong><code>dir.result</code></strong>.</p>
<p>The directory of the input .las/.laz files and the output file can be
specified in <strong><code>dir.data</code></strong> and
<strong><code>dir.result</code></strong> respectively. If not further
specified, the current working directory is used. The output .txt files
contain the reduced point clouds will be saved if not specified in
<strong><code>save.result</code></strong>.</p>
<p>If the point cloud in the input file was already normalized, the
argument <strong><code>normalized</code></strong> can be set to
<code>normalized = TRUE</code>. The effect is, that the one part of the
internal normalization process is skipped. Furthermore the scanning
approach applied for data collection must be specified in
<strong><code>scan.approach</code></strong> with <code>"single"</code>
(set by default) indicating the TLS single-scan approach and
<code>"multi"</code> indicating the TLS multi-scan and SLAM point clouds
approaches.</p>
<div class="section level4">
<h4 id="defining-the-point-cloud">Defining the point cloud<a class="anchor" aria-label="anchor" href="#defining-the-point-cloud"></a>
</h4>
<p>The planimetric coordinates <span class="math inline">\(x\)</span>
and <span class="math inline">\(y\)</span> of the center are by default
<code>x.center = 0</code> and <code>y.center = 0</code>. If this does
not coincide with the point cloud data, the coordinates of the plot
center must be specified by <strong><code>x.center</code></strong> and
<strong><code>y.center</code></strong>.</p>
<p>Furthermore the size of the point cloud can be reduced by the
arguments <strong><code>max.dist</code></strong>,
<strong><code>min.height</code></strong> and
<strong><code>max.height</code></strong>. If the maximum horizontal
distance in meter to the plot center (<code>max.dist</code>) is set,
points that are further away are discarded. Similarly, the minimum and
maximum height in meters (<code>min.height</code>,
<code>max.height</code> respectively) defines which points are
discarded, i.e. those below the minimum height and those above the
maximum height relative to the ground level. The default value for all
three arguments is <code>NULL</code>. Hence, no points are discarded
from the point cloud after normalization.</p>
</div>
<div class="section level4">
<h4 id="adjusting-the-algorithms-applied-in-normalize-function">Adjusting the algorithms applied in <code>normalize</code>
function<a class="anchor" aria-label="anchor" href="#adjusting-the-algorithms-applied-in-normalize-function"></a>
</h4>
<p>In order to generate the DTM, two different algorithms can be applied
specified by <strong><code>algorithm.dtm</code></strong>. Spatial
interpolation based on a k-nearest neighbor approach with
inverse-distance weighting (<code>knnidw</code>) is selected by default.
The second method is the Delaunay triangulation (<code>tin</code>). The
resolution of the DTM (`res.dtm``) is set to 0.2 m by default but can be
adjusted manually.</p>
<p>To manually adjust the CSF algorithm, a list with parameters
(e.g. the cloth resolution which is set to 0.5 by default) is introduced
in <strong><code>csf</code></strong>.</p>
<p>When the point clouds are colorized, the RGB values can be used to
improve the normalization and tree detection process
(<strong><code>RGB</code></strong>). The colors serve to distinguish
leafs from ground and stem points by the Green Leaf Algorithm (GLA,
Louhaichi et al., 2001<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>). If the GLA algorithm should be applied to
remove some points from the point cloud (i.e. leaf points), it must be
indicated by <code>RGB = TRUE</code>.</p>
</div>
</div>
<div class="section level3">
<h3 id="the-output">The output<a class="anchor" aria-label="anchor" href="#the-output"></a>
</h3>
<p>The <code>normalize</code> function generates a data frame shown
below. Each row corresponds to one point of the point cloud of the input
data. The columns <code>id</code>, <code>file</code> and
<code>point</code> indicate the plot identification number (by default
set to 1), the file name and the point number respectively. The
following columns contain the normalized Cartesian, cylindrical and
spherical coordinates <code>x</code> (distance on x axis in m),
<code>y</code> (distance on y axis in m), <code>z</code> (height
relative to ground level in m), <code>rho</code> (horizontal distance in
m), <code>phi</code> (angle in rad), <code>r</code> (radial distance in
m) and <code>theta</code> (polar angle in rad). The column
<code>slope</code> displays the slope of the terrain given in rad. If
the GLA algorithm was used, the column <code>GLA</code> shows the
results of that algorithm. Furthermore, a selection probability is
assigned to each point by applying the PCP algorithm (<code>prob</code>)
and the column <code>prob.select</code> shows the selected plots
(indicated with 1) and discarded points (indicated with 0).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pcd.single</span><span class="op">)</span>
<span class="co">#&gt;   id   file point      x       y     z      rho      phi        r       theta</span>
<span class="co">#&gt; 1  1 single     1 -3.385 -14.183 0.026 14.58135 4.478106 14.58137 0.001783098</span>
<span class="co">#&gt; 2  1 single     2 -3.394 -14.180 0.026 14.58052 4.477458 14.58055 0.001783199</span>
<span class="co">#&gt; 3  1 single     3 -3.379 -14.159 0.019 14.55661 4.478124 14.55662 0.001305248</span>
<span class="co">#&gt; 4  1 single     4 -3.312 -14.191 0.027 14.57237 4.483106 14.57239 0.001852820</span>
<span class="co">#&gt; 5  1 single     5 -3.304 -14.192 0.027 14.57152 4.483656 14.57155 0.001852927</span>
<span class="co">#&gt; 6  1 single     6 -3.370 -14.158 0.019 14.55355 4.478709 14.55356 0.001305523</span>
<span class="co">#&gt;   slope         GLA      prob prob.selec</span>
<span class="co">#&gt; 1     0 -0.08860759 0.1908750          0</span>
<span class="co">#&gt; 2     0 -0.09919571 0.1908534          0</span>
<span class="co">#&gt; 3     0 -0.07838480 0.1902276          0</span>
<span class="co">#&gt; 4     0 -0.07160494 0.1906399          0</span>
<span class="co">#&gt; 5     0 -0.05769231 0.1906179          0</span>
<span class="co">#&gt; 6     0 -0.06697460 0.1901477          1</span></code></pre></div>
<p>The .txt file saved to the directory indicated by
<code>dir.result</code> (if <code>save.result = TRUE</code>) contains a
similar data frame to that shown above. However, the data frame will
only include the reduced point cloud, i.e. only the selected points
(<code>prob.select = 1</code>). The data frame is saved without row
names as .txt file by using the <code>vroom_write</code> function of the
<a href="https://cran.r-project.org/web/packages/vroom/index.html" class="external-link">vroom</a>
package.</p>
</div>
</div>
<div class="section level2">
<h2 id="tree-detection">Tree detection<a class="anchor" aria-label="anchor" href="#tree-detection"></a>
</h2>
<p>The tree detection functions include algorithms to detect as many
trees as possible in the point clouds. Additionally, the diameter at 1.3
m above ground level (diameter at breast height, <span class="math inline">\(dbh\)</span>) is estimated and the coordinates of
the tree’s center are calculated for each detected tree. Depending on
the TLS approach, different tree detection functions should be used.</p>
<div class="section level3">
<h3 id="data-from-tls-single-scan-approach">Data from TLS single-scan approach<a class="anchor" aria-label="anchor" href="#data-from-tls-single-scan-approach"></a>
</h3>
<p>When the single-scan approach was used to collect the data, the
function <code>tree.detection.single.scan</code> can be applied as
follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tls.resolution</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>point.dist <span class="op">=</span> <span class="fl">6.34</span>, tls.dist <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>

<span class="va">tree.list.single.tls</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tree.detection.single.scan.html">tree.detection.single.scan</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pcd.single</span>,
                           dbh.min <span class="op">=</span> <span class="fl">4</span>, dbh.max <span class="op">=</span> <span class="fl">200</span>, h.min <span class="op">=</span> <span class="fl">1.3</span>,
                           ncr.threshold <span class="op">=</span> <span class="fl">0.1</span>,
                           tls.resolution <span class="op">=</span> <span class="va">tls.resolution</span>,
                           d.top <span class="op">=</span> <span class="cn">NULL</span>,
                           plot.attributes <span class="op">=</span> <span class="cn">NULL</span>,
                           breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">1.3</span>, <span class="fl">1.6</span><span class="op">)</span>, stem.section <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span>,
                           save.result <span class="op">=</span> <span class="cn">FALSE</span>, dir.result <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></code></pre></div>
<p>The normalized and reduced point cloud, i.e. the output of the
<code>normalize</code> function is the input data frame for this
function (<strong><code>data</code></strong>). The different arguments
that can be specified are explained below.</p>
<div class="section level4">
<h4 id="defining-the-range-of-diameters-and-heights-of-possible-trees">Defining the range of diameters and heights of possible trees<a class="anchor" aria-label="anchor" href="#defining-the-range-of-diameters-and-heights-of-possible-trees"></a>
</h4>
<p>With <strong><code>dbh.min</code></strong> and
<strong><code>dbh.max</code></strong>, the range of possible tree
diameters can be specified. Hence, only cluster of points with a bigger
diameter than <code>dbh.min</code> and a smaller diameter than
<code>dbh.max</code> will be considered as possible trees. Additionally,
<strong><code>min.height</code></strong> defines the minimum height of a
possible tree or point cluster to be considered as a tree. If not
manually specified, the values are set to <code>dbh.min = 4</code>,
<code>dbh.max = 200</code> (values in cm) and <code>h.min = 1.3</code>
(value in m).</p>
</div>
<div class="section level4">
<h4 id="resolution-of-the-tls">Resolution of the TLS<a class="anchor" aria-label="anchor" href="#resolution-of-the-tls"></a>
</h4>
<p>The resolution of the TLS scan
(<strong><code>tls.resolution</code></strong>) can be defined either by
the aperture angle or the distance between to consecutive points. The
aperture angle is determined by the horizontal and vertical aperture
angles (<code>horizontal.angle</code> and <code>vertical.angle</code>).
When choosing the angle to define the TLS resolution, both elements must
be part of the list required in
<code>tls.resolution = list(horizontal.angle, vertical.angle)</code>.
The second option to determine the resolution is by the distance of two
consecutive points (<code>point.dist</code>) at a certain distance from
the TLS device (<code>tls.dist</code>) as it is shown in the example
above.</p>
</div>
<div class="section level4">
<h4 id="integrate-further-information-about-the-plots">Integrate further information about the plots<a class="anchor" aria-label="anchor" href="#integrate-further-information-about-the-plots"></a>
</h4>
<p>In <strong><code>plot.attributes</code></strong> a data frame with
attributesa at plot level (e.g., strata) can be inserted for additional
information. This data frame must contain a column named <code>id</code>
coinciding with that used in the <code>id</code> argument of the
function <code>normalize</code>. If there are strata, the column
specifying the strata must be named <code>stratum</code> (numeric) for
other functionalities (e.g., <code>estimation.plot.size</code> or
<code>metrics.variables</code>). If this argument is not specified, it
will be set to NULL by default and the function will not add possible
plot attributes.</p>
</div>
<div class="section level4">
<h4 id="algorithm-to-distinguish-stem-points-and-foliage-points">Algorithm to distinguish stem points and foliage points<a class="anchor" aria-label="anchor" href="#algorithm-to-distinguish-stem-points-and-foliage-points"></a>
</h4>
<p>In order to distinguish stem points from points belonging to thin
branches or foliage, the local surface variation, also known as normal
change rate (NCR) is calculated for each point. This is a quantitative
measure of the curvature feature (Pauly et al., 2002<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>). For each point, the
NCR index is estimated in a local neighborhood with a radius of 5 cm.
This radius is considered as suitable for the stem separation in forests
(Ma et al. 2015<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>; Xia et al., 2015<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>). Higher NCR values
indicate more curved surfaces e.g. branches and foliage. Therefore, a
threshold (<strong><code>ncr.threshold</code></strong>) is established,
which can be modified manually. By defalut it is set to 0.1 according to
Zhang et al. (2019<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>), meaning that points with a higher NCR
value than the threshold are discarded.</p>
</div>
<div class="section level4">
<h4 id="algorithms-for-identification-of-trees">Algorithms for identification of trees<a class="anchor" aria-label="anchor" href="#algorithms-for-identification-of-trees"></a>
</h4>
<p>In order to improve the detection of trees, the point cloud is
reduced by removing parts of it with no trees. The argument
<strong><code>stem.section</code></strong> serves to identify the part
of the point cloud, i.e. a range of the coordinate z, which contains
less bushes, branches or other disruptive points. Hence, a range of the
coordinate z and therefore a belt-like area is selected, either by
defining the range manually or by an internal algorithm, that include
predominantly the stems of the trees. Within this horizontal area, point
clusters with higher density are chosen, which are supposedly the stems
of the trees. Applying a buffer around the stems, vertical cylinders are
created, which contain the stems. In the following algorithm only these
vertical cylindrical parts of the point cloud are used to detect
trees.</p>
<p>After the cylinders have been selected from the point cloud,
<strong><code>breaks</code></strong> defines the height (in m) of
horizontal slices on which the tree detection algorithms are applied. If
not otherwise specified, slices are taken every 0.3 m starting at a
height of 0.4 m until reaching the maximum height. The slices have a
extension of 0.1 m (height of slice +/- 5 cm). On each slice the
following algorithms are applied:</p>
<ul>
<li>
<strong>Removal of branches and foliage:</strong> The NCR values are
calculated for each point and only those points are kept as stem points
with a NCR value lower than the predefined threshold
(<code>ncr.threshold</code>)</li>
<li>
<strong>Clustering of the points:</strong> The clustering process is
applied on the horizontal projection of the point’s Cartesian
coordinates i.e., only their <span class="math inline">\(x\)</span> and
<span class="math inline">\(y\)</span> coordinates are considered. The
Density-Based Spatial Clustering of Applications based on the Noise
(DBSCAN) method (Ester et al., 1996<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a>) implemented by the <code>dbscan</code>
function of the <a href="https://cran.r-project.org/web/packages/dbscan/" class="external-link">dbscan</a>
package is used to perform the clustering. The radius of the epsilon
neighborhood (<code>eps</code>) is defined as the minimum distance
between two consecutive points at the furthest distance from the plot
center in the respective horizontal slice</li>
<li>
<strong>Removing of points belonging to remaining branches and
foliage:</strong> Two characteristics are used to distinguish stem and
branch clusters. First, the density of stem sections is higher than of
branch and foliage sections. And second, stem points should have a
predominant vertical distribution. Hence, when the point cloud is
vertical projected and dissected into a grid, cells over stems have a
higher point density than cells over leafs or branches. Points in cells
with a lower density than the median density are removed from the point
cloud</li>
<li>
<strong>Calculation of the center of the potential tree
section:</strong> The center is considered as the point in which the
variance of the distances between all cluster points and the potential
center point reaches its lowest value</li>
<li>
<strong>Classification of clusters:</strong> In order to decide
whether the clusters belong to a tree section, different geometric
features are considered. The calculated center of the tree section must
be located behind the stem point clusters relative to the TLS position.
No points should be located behind the tree surface relative to the TLS
position. The clusters should form an arc i.e., extreme points should
lay further away from the TLS than center points.</li>
</ul>
<p>As explained above, these algorithms are applied on all horizontal
slices (defined by <code>breaks</code>). Thus, tree sections are
identified at different heights. Those sections that belong to the same
tree are joined by applying the DBSCAN algorithm on the horizontal
projection of the different sections. Thereafter, tree attributes can be
estimated.</p>
</div>
<div class="section level4">
<h4 id="estimation-of-tree-attributes">Estimation of tree attributes<a class="anchor" aria-label="anchor" href="#estimation-of-tree-attributes"></a>
</h4>
<p>The diameter of the detected trees (dbh) is obtained at 1.3 m as the
double of radius. If the tree is not detected at 1.3 m the dbh is
estimated by fitting a linear taper function with radius as response
variable and the section heights as explanatory variables. Thus, the
radius at 1.3 m can be calculated and the dbh is twice the calculated
radius.</p>
<p>The argument <strong><code>d.top</code></strong> defines the top stem
diameter (in cm), which is used for the calculation of the commercial
stem volume. If this argument is not specified, the commercial stem
volume (<code>v.com</code>) is not calculated.</p>
</div>
<div class="section level4">
<h4 id="the-output-data-frame">The output data frame<a class="anchor" aria-label="anchor" href="#the-output-data-frame"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">tree.list.single.tls</span><span class="op">)</span></code></pre></div>
<p>The data frame shown above is the output of the
<code>tree.detect.single.scan</code> function. Each row represents a
detected tree (consecutively numbered in the column <code>tree</code>).
The columns <code>id</code> and <code>file</code> display the plot
identification number and the file name respectively equal to the
columns in the <code>normalize</code> output table. The coordinates of
the detected trees are given as Cartesian coordinates of the tree’s
center (<code>x</code> and <code>y</code>, in m) and azimuthal angles of
the center (<code>phi</code> in rad), the left border
(<code>phi.left</code> in rad), the right border (<code>phi.right</code>
in rad) and the horizontal distance from the tree’s center to the plot’s
center (<code>h.dist</code> in m).</p>
<p>Furthermore, the tree attributes <code>dbh</code> (diameter at breast
height in cm), <code>h</code> (total height in m), <code>v</code> (tree
stem volume in m^3) are estimated. If <code>d.top</code> was defined as
argument, the volume of the stem from the ground to the height given in
<code>d.top</code> is estimated (commercial stem volume,
<code>v.com</code> in m^3).</p>
<p>For each tree, the number of points of the normal section slice (1.3
m +/- 0.05 m) of the original point cloud and the reduced point cloud
(<code>n.pts</code> and <code>n.pts.red</code> respectively) are
calculated and also estimated (<code>n.pts.est</code> and
<code>n.pts.red.est</code> respectively). The column
<code>partial.occlusion</code> describes whether the the detected tree
is partially occluded (1) or not (0).</p>
<p>The data frame is saved as .csv file without row names using the
<code>write.csv</code> function from the <a href="https://cran.rstudio.com/web/packages/R.utils/index.html" class="external-link">utils</a>
package.</p>
</div>
</div>
<div class="section level3">
<h3 id="data-from-tls-multi-scan-approach">Data from TLS multi-scan approach<a class="anchor" aria-label="anchor" href="#data-from-tls-multi-scan-approach"></a>
</h3>
<p>When multiple scans were performed in the same sampling plot
(multi-scan approach) or SLAM devices were used, the function
<code>tree.detection.multi.scan</code> can be applied as follows below.
Additionally, the function <code>normalize</code> must be adjusted by
specifying <code>scan.approach = "multi"</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pcd.multi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalize.html">normalize</a></span><span class="op">(</span>las <span class="op">=</span> <span class="st">"Galicia_multi_scan.laz"</span>, 
                 <span class="co">#normalized = TRUE,</span>
                 x.center <span class="op">=</span> <span class="fl">0</span>, y.center <span class="op">=</span> <span class="fl">0</span>, RGB <span class="op">=</span> <span class="cn">TRUE</span>,
                 scan.approach <span class="op">=</span> <span class="st">"multi"</span>, file <span class="op">=</span> <span class="st">"multi.txt"</span>,
                 dir.data <span class="op">=</span> <span class="va">dir.data</span>, save.result <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">tree.list.multi.tls</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tree.detection.multi.scan.html">tree.detection.multi.scan</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pcd.multi</span>,
                          dbh.min <span class="op">=</span> <span class="fl">4</span>, dbh.max <span class="op">=</span> <span class="fl">200</span>, h.min <span class="op">=</span> <span class="fl">1.3</span>,
                          ncr.threshold <span class="op">=</span> <span class="fl">0.1</span>,
                          tls.precision <span class="op">=</span> <span class="fl">0.03</span>,
                          breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">1.3</span>, <span class="fl">1.6</span><span class="op">)</span>, stem.section <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span>,
                          d.top <span class="op">=</span> <span class="cn">NULL</span>,
                          plot.attributes <span class="op">=</span> <span class="cn">NULL</span>,
                          save.result <span class="op">=</span> <span class="cn">FALSE</span>, dir.result <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
<span class="co">#&gt; Loading required namespace: rgeos</span>
<span class="co">#&gt; Computing section: 1 m</span>
<span class="co">#&gt; Computing section: 1.3 m</span>
<span class="co">#&gt; Computing section: 1.6 m</span></code></pre></div>
<p>The function <code>tree.detection.multi.scan</code> comes along with
the same arguments as the function
<code>tree.detection.single.scan</code>, which are described in “Data
from TLS single-scan approach”. However, instead of specifying the
resolution, the precision of the TLS (in m) can be defined in
<code>tls.precision</code>. If not defined, the default value is 0.03 m.
The procedure remains the same and the output data frame contains the
all the columns explained above:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">tree.list.multi.tls</span><span class="op">)</span>
<span class="co">#&gt;   id      file tree          x          y       phi   h.dist      dbh     dbh2</span>
<span class="co">#&gt; 1  1 multi.txt    1  0.3315833  3.0619167 1.4629175 3.079835 32.84659 33.37792</span>
<span class="co">#&gt; 2  1 multi.txt    2 -3.7498333 -2.0185000 3.6354214 4.258680 35.28331 35.87306</span>
<span class="co">#&gt; 3  1 multi.txt    3  4.6889167 -0.3115833 6.2168892 4.699315 46.06891 46.95358</span>
<span class="co">#&gt; 4  1 multi.txt    4 -0.7014167 -5.2790833 4.5802697 5.325667 43.83220 44.51816</span>
<span class="co">#&gt; 5  1 multi.txt    5 -3.2165000 -4.6568333 4.1079304 5.659703 26.70114 27.18521</span>
<span class="co">#&gt; 6  1 multi.txt    6  3.9462500  4.8642500 0.8892174 6.263690 16.91162 17.32985</span>
<span class="co">#&gt;          h          v    n.pts n.pts.red n.pts.est n.pts.red.est</span>
<span class="co">#&gt; 1 19.60158 0.04860104 304.6667  78.33333 160.92107      39.82746</span>
<span class="co">#&gt; 2 19.96865 0.05593325 141.3333  34.33333 172.85894      42.78205</span>
<span class="co">#&gt; 3 22.12905 0.09407245 157.3333  43.00000 225.69948      55.85992</span>
<span class="co">#&gt; 4 21.32935 0.08555945 213.0000  50.00000 214.74143      53.14784</span>
<span class="co">#&gt; 5 16.13462 0.03311953 181.3333  44.00000 130.81345      32.37592</span>
<span class="co">#&gt; 6 17.57900 0.01309673  69.0000  19.00000  82.85289      20.50583</span>
<span class="co">#&gt;   partial.occlusion</span>
<span class="co">#&gt; 1                 1</span>
<span class="co">#&gt; 2                 0</span>
<span class="co">#&gt; 3                 0</span>
<span class="co">#&gt; 4                 1</span>
<span class="co">#&gt; 5                 1</span>
<span class="co">#&gt; 6                 0</span></code></pre></div>
<p>The following figure shows the same point cloud
(<code>"Galicia_multi_scan.laz"</code>) as above. The trees that were
detected by the <code>tree.detection.multi.scan</code> function are
labeled with a red belt at 1.3 m.</p>
<p><img src="pointcloud1diameter.jpg" alt="drawing" width="300"></p>
</div>
<div class="section level3">
<h3 id="automatic-normalization-and-tree-detection-of-several-plots">Automatic normalization and tree detection of several plots<a class="anchor" aria-label="anchor" href="#automatic-normalization-and-tree-detection-of-several-plots"></a>
</h3>
<p>If data from multiple plots are to be analysed, the function
<code>tree.detection.several.plots</code> can be used. This function
conducts both normalization and tree detection for each plot
automatically. The result tables (as explained above) are stored
directly and separately for each plot. Hence, if an error occurs in one
plot, the results of the previously analysed plots are stored.</p>
<p>In the function, the arguments for both the <code>normalize</code>
and <code>tree.detection</code> functions must be specified as explained
above. The function is applied as follows:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"las$"</span><span class="op">)</span>

<span class="va">tls.resolution</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>point.dist <span class="op">=</span> <span class="fl">7.67</span>, tls.dist <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>

<span class="va">tree.list.tls</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tree.detection.several.plots.html">tree.detection.several.plots</a></span><span class="op">(</span>las.list <span class="op">=</span> <span class="va">files</span>, 
                      id <span class="op">=</span> <span class="cn">NULL</span>, file <span class="op">=</span> <span class="cn">NULL</span>,
                      scan.approach <span class="op">=</span> <span class="st">"multi"</span>,
                      x.center <span class="op">=</span> <span class="fl">0</span>, y.center <span class="op">=</span> <span class="fl">0</span>,
                      max.dist <span class="op">=</span> <span class="fl">20</span>, min.height <span class="op">=</span> <span class="fl">0.1</span>, max.height <span class="op">=</span> <span class="cn">NULL</span>,
                      algorithm.dtm <span class="op">=</span> <span class="st">"knnidw"</span>, res.dtm <span class="op">=</span> <span class="fl">0.2</span>, 
                      csf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cloth_resolution <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,
                      
                      dbh.min <span class="op">=</span> <span class="fl">7</span>, dbh.max <span class="op">=</span> <span class="fl">200</span>, h.min <span class="op">=</span> <span class="fl">1.3</span>,
                      tls.resolution <span class="op">=</span> <span class="va">tls.resolution</span>,
                      ncr.threshold <span class="op">=</span> <span class="fl">0.05</span>,
                      breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">1.3</span>, <span class="fl">1.6</span>, <span class="fl">2</span>, <span class="fl">2.5</span>, <span class="fl">3</span><span class="op">)</span>,
                      stem.section <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">4</span><span class="op">)</span>,
                      d.top <span class="op">=</span> <span class="cn">NULL</span>, plot.attributes <span class="op">=</span> <span class="cn">NULL</span>,
                      dir.data <span class="op">=</span> <span class="va">dir.data</span>, save.result <span class="op">=</span> <span class="cn">FALSE</span>, dir.result <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></code></pre></div>
<p>The names of the .las files have to be introduced as a character
vector in <strong><code>las.list</code></strong>. Optionally, vectors
with the plot identification numbers and the file names can be specified
in <strong><code>id</code></strong> and
<strong><code>file</code></strong>. If not specified, the plots will be
named with correspondent numbers from 1 to n plots (<code>id</code>) and
their respective <code>id</code> in “id.txt” as file names. The other
arguments can be specified as explained in the sections above.</p>
<p>The insert files i.e., the plots are analysed successively. After
finishing the analysis of one plot, the reduced point cloud as .txt file
and the tree list as .csv file are saved to the directory indicated in
<strong><code>dir.results</code></strong>.</p>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>Roussel, J.R., Auty, D., Coops, N.C., Tompalski, P.,
Goodbody, T.R.H., Sanchez Meador, A., Bourdon, J.F., de Boissieu, F.,
Achim, A., 2020. lidR: an R package for analysis of Airborne Laser
Scanning (ALS) data. Remote Sens. Environ. 251, 112061 <a href="https://doi.org/10.1016/j.rse.2020.112061" class="external-link uri">https://doi.org/10.1016/j.rse.2020.112061</a>.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Zhang, W., Qi, J., Wan, P., Wang, H., Xie, D., Wang, X.,
Yan, G., 2016. An easy-to-use airborne LiDAR data filtering method based
on Cloth simulation. Rem. Sens. 8 (6), 501. <a href="https://doi.org/10.3390/rs8060501" class="external-link uri">https://doi.org/10.3390/rs8060501</a>.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Molina Valero, J.A., Ginzo Villamayor, M.J., Novo Pérez,
M.A., Álvarez-González, J.G., Pérez-Cruzado, C., 2019. Estimación del
área basimétrica en masas maduras de Pinus sylvestris en base a una
única medición del escáner láser terrestre (TLS). Cuad. Soc. Esp. Cienc.
For. 45 (3), 97–116. <a href="https://doi.org/10.31167/csecfv0i45.19887" class="external-link uri">https://doi.org/10.31167/csecfv0i45.19887</a>.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>Louhaichi, M., Borman, M. M., &amp; Johnson, D. E.
(2001). Spatially located platform and aerial photography for
documentation of grazing impacts on wheat. Geocarto International,
16(1), 65-70. <a href="doi:10.1080/10106040108542184" class="uri">doi:10.1080/10106040108542184</a><a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>Pauly, M., Gross, M., &amp; Kobbelt, L. P., (2002).
Efficient simplification of point-sampled surfaces. In IEEE Conference
on Visualization. (pp. 163-170). Boston, USA. <a href="https://doi.org/10.1109/VISUAL.2002.1183771" class="external-link uri">https://doi.org/10.1109/VISUAL.2002.1183771</a><a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>Ma, L., Zheng, G., Eitel, J. U., Moskal, L. M., He, W.,
&amp; Huang, H. (2015). Improved salient feature-based approach for
automatically separating photosynthetic and nonphotosynthetic components
within terrestrial lidar point cloud data of forest canopies. IEEE
Transactions Geoscience Remote Sensing, 54(2), 679-696. <a href="https://doi.org/10.1109/TGRS.2015.2459716" class="external-link uri">https://doi.org/10.1109/TGRS.2015.2459716</a><a href="#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>Xia, S., Wang, C., Pan, F., Xi, X., Zeng, H., &amp; Liu,
H. (2015). Detecting stems in dense and homogeneous forest using
single-scan TLS. Forests. 6(11), 3923-3945. <a href="https://doi.org/10.3390/f6113923" class="external-link uri">https://doi.org/10.3390/f6113923</a><a href="#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>Zhang, W., Wan, P., Wang, T., Cai, S., Chen, Y., Jin,
X., &amp; Yan, G. (2019). A novel approach for the detection of standing
tree stems from plot-level terrestrial laser scanning data. Remote Sens.
11(2), 211. <a href="https://doi.org/10.3390/rs11020211" class="external-link uri">https://doi.org/10.3390/rs11020211</a><a href="#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p>Ester, M., Kriegel, H.P., Sander, J., Xu, X., (1996). A
density-based algorithm for discovering clusters in large spatial
databases with noise. In Kdd 96 (34), 226–231.<a href="#fnref9" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Juan Alberto Molina-Valero, Adela Martínez-Calvo, Juan Gabriel Álvarez-González, Fernando Montes, César Pérez-Cruzado.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
