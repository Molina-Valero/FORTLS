<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Tree Detection and Cross Section Estimation — tree.detection.multi.scans • FORTLS</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Tree Detection and Cross Section Estimation — tree.detection.multi.scans"><meta property="og:description" content="Detects trees from TLS point clouds corresponding to multiple scans and SLAM point clouds. For each tree detected, the function calculates the central coordinates and estimates the diameter at 1.3 m above ground level (which is known as dbh, diameter at breast height) and classifies it as fully visible or partially occluded. Finally, the function obtains the number of points belonging to normal sections of trees (those corresponding to dbh +/- 5 cm) and estimates them for both original and reduced (with point cropping process) point clouds."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FORTLS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/Molina-Valero/FORTLS/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Tree Detection and Cross Section Estimation</h1>
    
    <div class="hidden name"><code>tree.detection.multi.scans.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Detects trees from TLS point clouds corresponding to multiple scans and SLAM point clouds. For each tree detected, the function calculates the central coordinates and estimates the diameter at 1.3 m above ground level (which is known as <em>dbh</em>, diameter at breast height) and classifies it as fully visible or partially occluded. Finally, the function obtains the number of points belonging to normal sections of trees (those corresponding to <em>dbh</em> +/- 5 cm) and estimates them for both original and reduced (with point cropping process) point clouds.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre><code>tree.detection,multiple.scans(data,
                              dbh.min = 7.5, dbh.max = 200,
                              ncr.threshold = 0.1,
                              tls.precision = NULL,
                              breaks = c(1.0, 1.3, 1.6),
                              plot.attributes = NULL,
                              save.result = TRUE, dir.result = NULL)</code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>data</dt>
<dd><p>Data frame with same description and format as indicated for <code><a href="normalize.html">normalize</a></code> ‘Value’.</p></dd>
<dt>dbh.min</dt>
<dd><p>Optional minimum <em>dbh</em> (cm) considered for detecting trees. By default it will be set at 7.5 cm.</p></dd>
<dt>dbh.max</dt>
<dd><p>Optional maximum <em>dbh</em> (cm) considered for detecting trees. By default it will be set at 200 cm.</p></dd>
<dt>ncr.threshold</dt>
<dd><p>Local surface variation (also known as normal change rate, NCR). By default it will be set as 0.1. For better understanding of this argument see ‘Details’.</p></dd>
<dt>tls.precision</dt>
<dd><p>Average point cloud precision in cm.</p></dd>
<dt>breaks</dt>
<dd><p>Height above ground level (m) of slices considered for detecting trees. By default it will be 1.0, 1.3 and 1.6 m (+/- 5 cm).</p></dd>
<dt>plot.attributes</dt>
<dd><p>Data frame with attributes at plot level. It must contain a column named <code>id</code> (character string or numeric value) with encoding coinciding with that used in <code>id</code> argument of <code><a href="normalize.html">normalize</a></code> for identifying plots. If there are strata, another column named ‘stratum’ (numeric) will be required for other functionalities of <span class="pkg">FORTLS</span> (see, for instance, <code><a href="estimation.plot.size.html">estimation.plot.size</a></code> or <code><a href="metrics.variables.html">metrics.variables</a></code>). If this argument is not specified by the user, it will be set to NULL by default and, as a consequence, the function will not add these possible plot attributes.</p></dd>
<dt>save.result</dt>
<dd><p>Optional logical which indicates whether or not the output files described in ‘Output Files’ section should be saved in <code>dir.result</code>. If this argument is not specified by the user, it will be set to <code>TRUE</code> by default and, as a consequence, the output files will be saved.</p></dd>
<dt>dir.result</dt>
<dd><p>Optional character string naming the absolute path of an existing directory where the files described in ‘Output Files’ section will be saved. <code>.Platform$file.sep</code> must be used as the path separator in <code>dir.result</code>. If this argument is not specified by the user, and the <code>save.result</code> is <code>TRUE</code>, it will be set to <code>NULL</code> by default and, as a consequence, the current working directory of the <span style="R">R</span> process will be assigned to <code>dir.result</code> during the execution.</p></dd>
</dl></div>
    <div id="details">
    <h2>Details</h2>
    

<p>Slices determined by <code>breaks</code> argument are clustered using the DBSCAN algorithm (Ester et al., 1996) on the horizontal plane according to Cartesian coordinates (x, y). Before and after this process, several algorithms are used to remove noisy points and apply classification criteria to select the clusters of trees.</p>
<p><em>dbh</em> is directly estimated for the section of 1.3 m above ground level, and estimated from other sections using <em>dbh</em>~<em>breaks</em> linear regression. Finally, the mean value of all estimates is provided in ‘Value’ as the <em>dbh</em> of the tree section.</p>
<p>The number of points corresponding to a normal section (+/- 5 cm) is estimated in proportion to <em>dbh</em>, using the average number of points per radius unit as reference. In this respect, only tree sections fully visible at 1.3 m above ground level will be considered for estimating the average number of points.</p>
<p>Local surface variation (also known as normal change rate ,NCR), is a quantitative measure of curvature feature (Pauly et al., 2002). This is useful for distinguishing points belonging to fine branches and foliage (e.g. leaves, shrubs) and stem points (e.g. Jin et al., 2016; Zhang et al., 2019). Just as we considered 5 cm as suitable for calculating local surface variation for the stem separation in forests, according to other authors (Ma et al., 2015; Xia et al., 2015), we also established the NCR threshold as 0.1, according to Zhang et al. (2019). However, this argument (<code>ncr.threshold</code>) may be modified in order to use more appropriate values.</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    <p>Data frame with the following columns for every tree detected (each row corresponds to one tree detected):</p>
<dl><dt>id</dt>
<dd><p>Optional plot identification encoded as a character string or numeric. If this argument is not specified by the user, it will be set to NULL by default and, as a consequence, the plot will be encoded as 1.</p></dd>
<dt>file</dt>
<dd><p>Optional file name identification encoded as character string or numeric. If it is null, the file will be encoded as <code>id</code> by default.</p></dd>
<dt>tree</dt>
<dd><p>tree numbering</p></dd>
<dt>Coordinates</dt>
<dd>

<p>Cartesian (according to <a href="https://en.wikipedia.org/wiki/Cartesian_coordinate_system" class="external-link">https://en.wikipedia.org/wiki/Cartesian_coordinate_system</a> notation):</p></dd>
</dl><ul><li><p><code>x</code>: distance on x axis (m) of tree centre.</p></li>
<li><p><code>y</code>: distance on y axis (m) of tree centre.</p></li>
</ul><p>Azimuthal angles:</p><ul><li><p><code>phi</code>: angular coordinate (rad) of tree centre.</p></li>
</ul><dl><dt>h.dist</dt>
<dd><p>horizontal distance (m) from plot centre to tree centre.</p></dd>
<dt><em>dbh</em></dt>
<dd><p>estimated tree diameter (cm) at breast height (1.3 m).</p></dd>
<dt><em>h</em></dt>
<dd><p>estimated tree total height (m).</p></dd>
<dt>num.points</dt>
<dd><p>number of points corresponding to a normal section (+/- 5 cm) in the original point cloud.</p></dd>
<dt>num.points.hom</dt>
<dd><p>number of points corresponding to a normal section (+/- 5 cm) in the point cloud reduced by the point cropping process.</p></dd>
<dt>num.points.est</dt>
<dd><p>number of points estimated for a normal section (+/- 5 cm) in the original point cloud.</p></dd>
<dt>num.points.hom.est</dt>
<dd><p>number of points estimated for a normal section (+/- 5 cm) in the point cloud reduced by the point cropping process.</p></dd>
<dt>partial.occlusion</dt>
<dd><p>yes (1) or no (0)</p></dd>
</dl></div>
    <div id="output-files">
    <h2>Output Files</h2>
    

<p>At the end of the tree detection process, if the <code>save.result</code> argument is <code>TRUE</code>, the function will save the data frame described in ‘Value’ as a CSV file named ‘tree.list.tls.csv’. The data frame will be written without row names in the <code>dir.result</code> directory by using <code><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></code> function from the <span class="pkg">utils</span> package.</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>Although <code>tree.detection</code> also works with reduced point clouds, thus reducing the computing time, use of the original point cloud is recommended in order to detect more trees. This will also depend on forest conditions, especially those related to visibility. The more distant the trees are, the lower the density of points will be, and using reduced point clouds will therefore complicate detection of the most distant trees.</p>
<p>Note that <code>dbh.min</code> and <code>dbh.max</code> are important for avoiding outlier values when inventory data are used for reference purposes. Otherwise, knowledge about the autoecology of species could be used for filtering anomalous values of <em>dbh</em>.</p>
<p>The argument <code>breaks = 1.3</code> could be sufficient for detecting trees visible at <em>dbh</em>, involving lower computational cost. However, those trees not detected at <em>dbh</em>, may be estimated from lower and/or higher sections. Considering the three default sections in the argument <code>breaks = c(1.0, 1.3, 1.6)</code> maintains a good balance in the case study of this package.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Ester, M., Kriegel, H. P., Sander, J., &amp; Xu, X. (1996). A density-based algorithm for discovering clusters in large spatial databases with noise. In Kdd (Vol. 96, No. 34, pp. 226-231).</p>
<p>Jin, S., Tamura, M., &amp; Susaki, J. (2016). A new approach to retrieve leaf normal distribution using terrestrial laser scanners. J. <em>Journal of Forestry Research</em>, <b>27(3)</b>, 631-638. doi: <a href="https://doi.org/10.1007/s11676-015-0204-z" class="external-link">10.1007/s11676-015-0204-z</a></p>
<p>Ma, L., Zheng, G., Eitel, J. U., Moskal, L. M., He, W., &amp; Huang, H. (2015). Improved salient feature-based approach for automatically separating photosynthetic and nonphotosynthetic components within terrestrial lidar point cloud data of forest canopies. <em>IEEE Transactions Geoscience Remote Sensing</em>, <b>54(2)</b>, 679-696. doi: <a href="https://doi.org/10.1109/TGRS.2015.2459716" class="external-link">10.1109/TGRS.2015.2459716</a></p>
<p>Pauly, M., Gross, M., &amp; Kobbelt, L. P., (2002). Efficient simplification of point-sampled surfaces. In IEEE Conference on Visualization. (pp. 163-170). Boston, USA. doi: <a href="https://doi.org/10.1109/VISUAL.2002.1183771" class="external-link">10.1109/VISUAL.2002.1183771</a></p>
<p>Xia, S., Wang, C., Pan, F., Xi, X., Zeng, H., &amp; Liu, H. (2015). Detecting stems in dense and homogeneous forest using single-scan TLS. <em>Forests</em>. <b>6(11)</b>, 3923-3945. doi: <a href="https://doi.org/10.3390/f6113923" class="external-link">10.3390/f6113923</a></p>
<p>Zhang, W., Wan, P., Wang, T., Cai, S., Chen, Y., Jin, X., &amp; Yan, G. (2019). A novel approach for the detection of standing tree stems from plot-level terrestrial laser scanning data. <em>Remote Sens</em>. <b>11(2)</b>, 211. doi: <a href="https://doi.org/10.3390/rs11020211" class="external-link">10.3390/rs11020211</a></p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Juan Alberto Molina-Valero,
María José Ginzo Villamayor,
Manuel Antonio Novo Pérez,
Adela Martínez-Calvo,
Juan Gabriel Álvarez-González,
Fernando Montes and
César Pérez-Cruzado.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="normalize.html">normalize</a></code>, <code>tree.detection.multiple</code>, <code><a href="distance.sampling.html">distance.sampling</a></code>, <code><a href="estimation.plot.size.html">estimation.plot.size</a></code>, <code><a href="simulations.html">simulations</a></code>, <code><a href="metrics.variables.html">metrics.variables</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"></span>
<span class="r-in"><span class="co"># \donttest{</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Establishment of working directories (optional)</span></span>
<span class="r-in"><span class="co"># By default here we propose the current working directory of the R process</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">dir.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in"><span class="va">dir.result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Loading example data of SLAM point cloud (LAS file) to dir.data</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="st">"https://www.dropbox.com/s/j15lkv0rv2id69e/multiple.scans.las?dl=0</span>
<span class="r-in">"</span>,</span>
<span class="r-in">              destfile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir.data</span>, <span class="st">"multiple.scans.las"</span><span class="op">)</span>,</span>
<span class="r-in">              , mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Normalizing the point cloud data as a neccesary step for detecting trees</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">pcd</span> <span class="op">&lt;-</span> <span class="fu"><a href="normalize.html">normalize</a></span><span class="op">(</span>las <span class="op">=</span> <span class="st">"multiple.scans.las"</span>,</span>
<span class="r-in">                 max.height <span class="op">=</span> <span class="fl">45</span>,</span>
<span class="r-in">                 algorithm.dtm <span class="op">=</span> <span class="st">"knnidw"</span>,</span>
<span class="r-in">                 res.dtm <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span class="r-in">                 multiple.scans <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span class="r-in">                 dir.data <span class="op">=</span> <span class="va">dir.data</span>, dir.result <span class="op">=</span> <span class="va">dir.result</span><span class="op">)</span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in normalize(las = "multiple.scans.las", max.height = 45, algorithm.dtm = "knnidw",     res.dtm = 0.25, multiple.scans = TRUE, dir.data = dir.data,     dir.result = dir.result):</span> unused argument (multiple.scans = TRUE)</span>
<span class="r-in"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Tree detection without considering arguments</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">tree.list.tls</span> <span class="op">&lt;-</span> <span class="fu">tree.detection.multiple.scans</span><span class="op">(</span>data <span class="op">=</span> <span class="va">pcd</span>,</span>
<span class="r-in">                                               dir.result <span class="op">=</span> <span class="va">dir.result</span><span class="op">)</span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in tree.detection.multiple.scans(data = pcd, dir.result = dir.result):</span> could not find function "tree.detection.multiple.scans"</span>
<span class="r-in"></span>
<span class="r-in">  <span class="co"># }</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Juan Alberto Molina-Valero, Adela Martínez-Calvo, Juan Gabriel Álvarez-González, Fernando Montes, César Pérez-Cruzado.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer></div>

  


  

  </body></html>

